(function(){(function(b){var a;a=b.App||{};a.Views=a.Views||{};a.Views.docV=Backbone.View.extend({initialize:function(){this.linkOne=$(this.$el).find("nav#navigation").find("ul").find("li").find("a")[0];return this.addModal()},addModal:function(){var c;c=(Mustache.compile(a.Templates.modalBox))();$(this.$el).append(c);$($(this.$el).find(".modalBox")[0]).hide();this.modalEl=$($(this.$el).find(".modalBox")[0]);return this.modalHeight()},modalHeight:function(){var c;$(this.modalEl).css("min-height",$(this.$el).height());c=$(b).height()-150;return $(this.modalEl).find(".modalcontainer").css("height",c)},modal:function(e){var g,h,i,d,f,c;if(e.action!=null){switch(e.action){case"show":c=$(e.e.currentTarget).attr("href");d=$(e.e.currentTarget).closest("section").attr("id");h={};i=_.find(e.data,function(k,j){if(d===j){return k}});g=[];_.each(i,function(j){return _.each(j,function(k){return g.push(k)})});f=_.find(g,function(j){if(j.link===c){return j}});return this.parseModal(f);case"close":return $(this.modalEl).hide();default:return $(this.modalEl).hide()}}},events:{"click .modalBox a.close":"closeModal","click .modalcontainer":"doNothing","click .modalcontainer a":"clickContainer","click .modalBox":"closeModal"},closeModal:function(c){c.preventDefault();c.stopPropagation();return this.modal({action:"close"})},doNothing:function(c){c.preventDefault();return c.stopPropagation()},clickContainer:function(c){c.preventDefault();if(!$(c.currentTarget).hasClass("close")){return b.open($(c.currentTarget).attr("href"))}},parseModal:function(f){var e,d,c;this.modalHeight();e=$(this.modalEl).find("#div-gpt-ad-1372719961964-0");if(e.length===0){d=(Mustache.compile(a.Templates.modalBoxEntriePub))({Pub:a.Templates.pub300250});$(this.modalEl).find(".modalcontainer").find(".modalEntrie").html(d)}c=(Mustache.compile(a.Templates.modalBoxEntrie))(f);$(this.modalEl).find(".modalcontainer").find(".entrieEntrie").html(c);return $(this.modalEl).show()}});a.Views.mainResponseV=Backbone.View.extend({initialize:function(){var c=this;this.collection.on("add",this.addOne,this);this.collection.on("reset",this.reset,this);this.collection.reset();this.fetchingColl=this.collection.fetch();return this.fetchingColl.fail(function(){return c.errorMsg()})},addOne:function(d){var c;c=new a.Views.sectionV({model:d});c.reder();return $(this.$el).append(c.el)},reset:function(){return $(this.$el).html("")},isIe:function(){if($.browser!=null){if($.browser.msie!=null){this.errorMsg();return true}}return false},errorMsg:function(){return $(this.$el).html(a.Templates.Woops)},goTo:function(c){var d=this;this.deferred=$.Deferred();this.deferred.done(function(){var e;if(d.url!=null){e=d.url[1].split(":");return _.each($(d.$el).find("#"+d.url[0]).find(".box"),function(g,f){var i,h;i=$(g).data("modelid");if(i===e[0]){h=parseInt(e[1])-1;return $($(g).find(".articlePagination").find("a")[h]).trigger("click")}})}});this.fetchingColl.done(function(){$(d.$el).find("section").hide();return $(d.$el).find("#"+c).show()});return this.deferred.promise()}});a.Views.sectionV=Backbone.View.extend({tagName:"section",entries:{},reder:function(){var c,d;$(this.$el).attr("id",this.model.get("name"));d={items:this.model.get("items"),name:this.model.get("name")};c=(Mustache.compile(a.Templates.boxItem))(d);$(this.$el).html(c);$(this.$el).hide();return this.setItemModels()},setItemModels:function(){var e,c,d,f=this;e=$(this.$el).find("div.box");if(this.allViews==null){this.allViews={}}d=this.model.get("name");c=[];_.each(e,function(j,h){var k,i,g;k=$(j).data("modelid");i=_.find(f.model.attributes.items,function(l){if(l.id===k){return l}});i.section=d;f.itemModel=new a.Models.blogItem(i);g=new a.Views.blogItemV({model:f.itemModel,el:$(j)});g.load().done(function(l){if(l==null){l=[]}if(f.entries[f.model.attributes.name]==null){f.entries[f.model.attributes.name]=[]}return f.entries[f.model.attributes.name].push(l)});return c.push(g)});return this.allViews[d]=c},events:{"click .articlePagination a":"pagination","click a.readmore":"viewNote","click article header a":"viewNote"},viewNote:function(d){var c;d.preventDefault();c={action:"show",data:this.entries,e:d};return a.bundle.docV.modal(c)},pagination:function(i){var c,h,d,j,g,f;i.preventDefault();$(i.currentTarget).closest("div").find("a").removeClass("active");$(i.currentTarget).addClass("active");f=parseInt($(i.currentTarget).html())-1;c=$(i.currentTarget).closest("div.box").find("article");$(c).hide();$($(c)[f]).show();d=$(i.currentTarget).closest(".box");h=$(d).data("modelid");g=$(i.currentTarget).closest("section");j=$(g).attr("id");return Backbone.history.navigate(""+j+"/"+h+":"+($(i.currentTarget).html()),{trigger:true})}});a.Views.blogItemV=Backbone.View.extend({render:function(){var f,c,e,d;f={entries:this.model.attributes.entries,model:this.model.attributes};d=(Mustache.compile(a.Templates.entries))(f);$(this.$el).html(d);$(this.$el).find("article").not(":eq(0)").hide();c=[];_.each(this.model.attributes.entries,function(h,g){return c.push({index:g+1})});f={items:c};d=(Mustache.compile(a.Templates.pagination))(f);$(this.$el).append(d);e=$(this.$el).find(".articlePagination").find("a")[0];return $(e).addClass("active")},load:function(){var d,c,e=this;this.deferred=$.Deferred();$(this.$el).append($('<div class="tmp"></div>'));c=$(this.$el).find(".tmp");$(c).hide();this.deferred.done(function(){e.render();return $(e.$el).find(".tmp").remove()});d={feeds:{feed:this.model.attributes.urlFeed},max:10,onComplete:function(f){e.model.attributes.entries=f;e.deferred.resolve(f);if(a.bundle.reponseV.url!=null){if(a.bundle.reponseV.url[1].split(":")[0]===e.model.attributes.id){return a.bundle.reponseV.deferred.resolve()}}}};$(c).feeds(d);return this.deferred.promise()}});return b.App=a})(window)}).call(this);