/*
 * jQuery Feeds v0.5
 * https://camagu.github.com/jquery-feeds
 * 
 * Copyright (c) 2012, Camilo Aguilar
 * Dual licensed under the MIT and GPL licenses:
 *     http://www.opensource.org/licenses/mit-license.php
 *     http://www.gnu.org/licenses/gpl.html
 * 
 * Includes a modified version of Simple JavaScript Templating
 * http://ejohn.org/blog/javascript-micro-templating/
 * Copyright (c) John Resig (http://ejohn.org)
 * MIT licensed
 * 
 * Date: 2012-07-12
 */
(function(b){var a={};b.fn.feeds=function(d){var e={service:"//ajax.googleapis.com/ajax/services/feed/load?v=1.0",settings:{loadingTemplate:'<p class="feeds-loader">Loading entries ...</p>',entryTemplate:'<div class="feeds-entry feeds-source-<!=source!>"><a class="feed-entry-title" target="_blank" href="<!=link!>" title="<!=title!>"><!=title!></a><div class="feed-entry-date"><!=publishedDate!></div><div class="feed-entry-content"><!=contentSnippet!></div></div>',feeds:{},max:-1,ssl:"auto",onComplete:function(f){},preprocess:function(f,g){}},feeds:{},entries:[],feedsLength:0,feedsLoaded:0,$element:null,$loader:null,init:function(k,g){this.settings=b.extend(this.settings,g);this.feeds=this.settings.feeds;for(var h in this.feeds){if(this.feeds.hasOwnProperty(h)){this.feedsLength++}}var m=this.settings.ssl==="auto"?document.location.protocol:this.settings.ssl?"https:":"http:";if(b.inArray(m,["http:","https"])===-1){m="https:"}this.service=m+this.service;this.$element=b(k);var l=typeof this.settings.loadingTemplate==="function"?this.settings.loadingTemplate:this.tmpl(this.settings.loadingTemplate);this.$loader=b(l.call(this,{}));this.$element.html(this.$loader);for(var f in this.feeds){this.fetchFeed(f,this.feeds[f],this.settings.max)}},fetchFeed:function(h,i,f){var g=this;var j=i+"**"+f;if(typeof a[j]!=="undefined"){g.processResponse(a[j],h,i);return}b.ajax({url:this.service,dataType:"jsonp",data:{q:i,num:f},beforeSend:function(){this.feed=i;this.key=h},success:function(k){a[j]=k;g.processResponse(k,this.key,this.feed)}})},processResponse:function(l,h,k){if(l.responseStatus!==200){if(window.console&&window.console.log){console.log("Unable to load feed "+k+": ("+l.responseStatus+") "+l.responseDetails)}}else{var g=l.responseData.feed.entries;for(var f in g){var j=b.extend({},g[f]);j.source=h;j.publishedDateRaw=j.publishedDate;j.feedUrl=l.responseData.feed.feedUrl;j.feedTitle=l.responseData.feed.title;j.feedLink=l.responseData.feed.link;j.feedDescription=l.responseData.feed.description;j.feedAuthor=l.responseData.feed.author;this.settings.preprocess.call(j,l.responseData.feed);this.entries.push(j)}}this.feedsLoaded++;this.checkComplete()},checkComplete:function(){if(this.feedsLoaded===this.feedsLength){this.$loader.remove();this.entries.sort(function(k,i){var m=new Date(k.publishedDateRaw).getTime();var l=new Date(i.publishedDateRaw).getTime();return l-m});var h=typeof this.settings.entryTemplate==="function"?this.settings.entryTemplate:this.tmpl(this.settings.entryTemplate);for(var g in this.entries){var j=this.entries[g];var f=h.call(this,j);this.$element.append(f)}this.settings.onComplete.call(this.$element[0],this.entries)}},tmplCache:{},tmpl:function c(h,g){var f=!/\W/.test(h)?this.tmplCache[h]=this.tmplCache[h]||this.tmpl(document.getElementById(h).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+h.replace(/[\r\t\n]/g," ").split("<!").join("\t").replace(/((^|!>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!>/g,"',typeof $1 != 'undefined' ? $1 : '','").split("\t").join("');").split("!>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return g?f(g):f}};return b(this).each(function(){e.init(this,d)})}}(jQuery));